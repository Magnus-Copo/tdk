import './styles/main.scss';

// Scroll reveal animation
const observerOptions = {
    threshold: 0.1,
    rootMargin: '50px' // Positive margin to trigger slightly before element enters viewport
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('active');
        }
    });
}, observerOptions);

document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

// Modal functions
// Exposed to window because the HTML uses onclick attributes
window.showBookingModal = function () {
    const modal = document.getElementById('bookingModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

window.hideBookingModal = function () {
    const modal = document.getElementById('bookingModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

window.hideSuccessModal = function () {
    const modal = document.getElementById('successModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

window.handleBookingSubmit = function (e) {
    e.preventDefault();
    window.hideBookingModal();
    const successModal = document.getElementById('successModal');
    if (successModal) {
        successModal.style.display = 'flex';
    }
    e.target.reset();
}

// Close modal on outside click
const bookingModal = document.getElementById('bookingModal');
if (bookingModal) {
    bookingModal.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) window.hideBookingModal();
    });
}

const successModal = document.getElementById('successModal');
if (successModal) {
    successModal.addEventListener('click', (e) => {
        if (e.target === e.currentTarget) window.hideSuccessModal();
    });
}

// Close on Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        window.hideBookingModal();
        window.hideSuccessModal();
    }
});

// ============================================
// ðŸ¦¸ HERO SECTION MODERN ANIMATIONS
// Using Web Animations API for CSS-safe animations
// ============================================

// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', () => {
    const hero = document.getElementById('hero');
    if (!hero) return;

    // Hero Image - breathing pulse animation
    const heroImage = hero.querySelector('img[alt*="Children"]');
    if (heroImage) {
        // Subtle breathing animation
        heroImage.animate([
            { transform: 'scale(1)', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.15)' },
            { transform: 'scale(1.02)', boxShadow: '0 30px 60px -10px var(--shadow-primary-soft)' },
            { transform: 'scale(1)', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.15)' }
        ], {
            duration: 6000,
            iterations: Infinity,
            easing: 'ease-in-out'
        });

        // Hover effect via JS
        heroImage.addEventListener('mouseenter', () => {
            heroImage.style.transform = 'scale(1.04) rotate(-1deg)';
            heroImage.style.boxShadow = '0 40px 80px -15px rgba(0, 0, 0, 0.2), 0 0 50px var(--shadow-primary-soft)';
            heroImage.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.5s ease';
        });
        heroImage.addEventListener('mouseleave', () => {
            heroImage.style.transform = '';
            heroImage.style.boxShadow = '';
        });
    }

    // Badge - gentle floating animation
    const badge = hero.querySelector('div[style*="9999px"]');
    if (badge) {
        badge.animate([
            { transform: 'translateY(0)' },
            { transform: 'translateY(-8px)' },
            { transform: 'translateY(0)' }
        ], {
            duration: 4000,
            iterations: Infinity,
            easing: 'ease-in-out'
        });

        // Hover effect
        badge.addEventListener('mouseenter', () => {
            badge.style.transform = 'translateY(-4px) scale(1.02)';
            badge.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.12)';
            badge.style.transition = 'all 0.3s ease';
        });
        badge.addEventListener('mouseleave', () => {
            badge.style.transform = '';
            badge.style.boxShadow = '';
        });
    }

    // Stats - staggered entrance and hover effects
    const statsContainer = hero.querySelector('div[style*="gap: 48px"]');
    if (statsContainer) {
        const stats = statsContainer.querySelectorAll(':scope > div');
        stats.forEach((stat, index) => {
            // Staggered entrance animation
            stat.animate([
                { opacity: 0, transform: 'translateY(30px)' },
                { opacity: 1, transform: 'translateY(0)' }
            ], {
                duration: 600,
                delay: 800 + (index * 150),
                fill: 'forwards',
                easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
            });

            // Hover effect
            stat.style.cursor = 'default';
            stat.addEventListener('mouseenter', () => {
                stat.style.transform = 'translateY(-8px)';
                stat.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                const number = stat.querySelector('div:first-child');
                if (number) {
                    number.style.color = 'var(--color-primary)';
                    number.style.transition = 'color 0.3s ease';
                }
            });
            stat.addEventListener('mouseleave', () => {
                stat.style.transform = '';
                const number = stat.querySelector('div:first-child');
                if (number) number.style.color = '';
            });
        });
    }

    // H1 Title - subtle float (NOT touching the gradient-text span at all)
    const heroTitle = hero.querySelector('h1');
    if (heroTitle) {
        heroTitle.animate([
            { transform: 'translateY(0)' },
            { transform: 'translateY(-4px)' },
            { transform: 'translateY(0)' }
        ], {
            duration: 5000,
            iterations: Infinity,
            easing: 'ease-in-out'
        });
    }

    // Description paragraph - subtle hover effect
    const heroDesc = hero.querySelector('p');
    if (heroDesc) {
        heroDesc.addEventListener('mouseenter', () => {
            heroDesc.style.transform = 'translateX(6px)';
            heroDesc.style.transition = 'transform 0.3s ease';
        });
        heroDesc.addEventListener('mouseleave', () => {
            heroDesc.style.transform = '';
        });
    }

    // Parallax effect on mouse move for the whole hero
    hero.addEventListener('mousemove', (e) => {
        const rect = hero.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;

        // Apply subtle parallax to blobs
        const blobs = hero.querySelectorAll('.blob');
        blobs.forEach((blob, index) => {
            const speed = 15 + (index * 5);
            blob.style.transform = `translate(${x * speed}px, ${y * speed}px)`;
            blob.style.transition = 'transform 0.3s ease-out';
        });

        // Apply subtle parallax to hero image
        if (heroImage) {
            heroImage.style.transform = `perspective(1000px) rotateY(${x * 3}deg) rotateX(${-y * 3}deg)`;
        }
    });

    hero.addEventListener('mouseleave', () => {
        const blobs = hero.querySelectorAll('.blob');
        blobs.forEach(blob => {
            blob.style.transform = '';
        });
        if (heroImage) {
            heroImage.style.transform = '';
        }
    });

    // ============================================
    // ðŸ§  NEUROPSYCHOLOGY-BASED UI/UX ENHANCEMENTS
    // Dopamine triggers, attention guidance, trust building
    // ============================================

    // 1. MAGNETIC BUTTONS - Creates satisfying micro-interaction
    const magneticButtons = document.querySelectorAll('.btn-primary, .btn-secondary');
    magneticButtons.forEach(btn => {
        btn.addEventListener('mousemove', (e) => {
            const rect = btn.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;

            btn.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px) scale(1.02)`;
            btn.style.transition = 'transform 0.2s ease-out';
        });

        btn.addEventListener('mouseleave', () => {
            btn.style.transform = '';
        });

        btn.addEventListener('mousedown', () => {
            btn.style.transform = 'scale(0.95)';
        });
        btn.addEventListener('mouseup', () => {
            btn.style.transform = 'scale(1.05)';
            setTimeout(() => btn.style.transform = '', 150);
        });
    });

    // 2. CARD 3D TILT EFFECT
    const cards = document.querySelectorAll('.card-hover');
    cards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width - 0.5;
            const y = (e.clientY - rect.top) / rect.height - 0.5;

            card.style.transform = `perspective(1000px) rotateY(${x * 10}deg) rotateX(${-y * 10}deg) translateZ(20px) scale(1.02)`;
            card.style.transition = 'transform 0.15s ease-out';
            card.style.boxShadow = `${x * 20}px ${y * 20}px 40px rgba(0,0,0,0.1), 0 0 30px var(--shadow-primary-soft)`;
        });

        card.addEventListener('mouseleave', () => {
            card.style.transform = '';
            card.style.boxShadow = '';
            card.style.transition = 'transform 0.5s ease, box-shadow 0.5s ease';
        });
    });

    // 3. PROGRESS BAR ANIMATIONS
    const progressBars = document.querySelectorAll('div[style*="linear-gradient(90deg, var(--color-primary), var(--color-calm))"], div[style*="linear-gradient(90deg, #3A8DFF, #7BD389)"]');
    progressBars.forEach(bar => {
        const originalWidth = bar.style.width;

        const progressObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    bar.style.width = '0%';
                    bar.animate([
                        { width: '0%' },
                        { width: originalWidth }
                    ], {
                        duration: 1500,
                        easing: 'cubic-bezier(0.4, 0, 0.2, 1)',
                        fill: 'forwards'
                    });
                    progressObserver.unobserve(bar);
                }
            });
        }, { threshold: 0.5 });

        progressObserver.observe(bar);
    });

    // 4. SECTION TYPOGRAPHY REVEAL
    const sectionHeadings = document.querySelectorAll('section h2, section h3');
    sectionHeadings.forEach(heading => {
        const headingObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    heading.animate([
                        { opacity: 0, transform: 'translateY(20px)' },
                        { opacity: 1, transform: 'translateY(0)' }
                    ], {
                        duration: 600,
                        fill: 'forwards',
                        easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
                    });
                    headingObserver.unobserve(heading);
                }
            });
        }, { threshold: 0.3 });

        headingObserver.observe(heading);
    });

    // 5. NAVIGATION LINKS - Underline sweep
    const navLinks = document.querySelectorAll('.desktop-nav a');
    navLinks.forEach(link => {
        link.style.position = 'relative';

        const underline = document.createElement('span');
        underline.style.cssText = `
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-calm));
            border-radius: 2px;
            transition: width 0.3s ease;
        `;
        link.appendChild(underline);

        link.addEventListener('mouseenter', () => {
            underline.style.width = '100%';
            link.style.color = 'var(--color-primary)';
            link.style.transition = 'color 0.3s ease';
        });

        link.addEventListener('mouseleave', () => {
            underline.style.width = '0';
            link.style.color = '';
        });
    });

    // 6. FORM INPUT FOCUS EFFECTS
    const formInputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="date"]');
    formInputs.forEach(input => {
        input.addEventListener('focus', () => {
            input.style.boxShadow = '0 0 0 4px var(--shadow-primary-soft), 0 4px 12px var(--shadow-primary-soft)';
            input.style.transform = 'scale(1.01)';
            input.style.transition = 'all 0.3s ease';
        });
        input.addEventListener('blur', () => {
            input.style.boxShadow = '';
            input.style.transform = '';
        });
    });

    // 7. SCROLL PROGRESS INDICATOR
    const scrollProgress = document.createElement('div');
    scrollProgress.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        height: 3px;
        background: linear-gradient(90deg, #3A8DFF, #7BD389);
        z-index: 9999;
        width: 0%;
        transition: width 0.1s ease-out;
    `;
    document.body.appendChild(scrollProgress);

    window.addEventListener('scroll', () => {
        const scrollTop = window.scrollY;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = (scrollTop / docHeight) * 100;
        scrollProgress.style.width = scrollPercent + '%';
    });

    // ============================================
    // âœ¨ SAFE KINETIC TYPOGRAPHY
    // Only enhances elements with opt-in classes
    // Does NOT modify innerHTML of any elements
    // ============================================

    // 1. TEXT COLOR REVEAL - Animate .text-reveal-color on scroll
    document.querySelectorAll('.text-reveal-color').forEach(el => {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    el.classList.add('active');
                    observer.unobserve(el);
                }
            });
        }, { threshold: 0.5 });
        observer.observe(el);
    });

    // 2. AGE NUMBERS - Pop-in animation for .age-display
    document.querySelectorAll('.age-display').forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'scale(0.8)';

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    el.animate([
                        { transform: 'scale(0.8) rotate(-5deg)', opacity: 0 },
                        { transform: 'scale(1.05) rotate(2deg)', opacity: 1 },
                        { transform: 'scale(1) rotate(0)', opacity: 1 }
                    ], {
                        duration: 500,
                        delay: index * 80,
                        fill: 'forwards',
                        easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)'
                    });
                    observer.unobserve(el);
                }
            });
        }, { threshold: 0.3 });
        observer.observe(el);
    });

    // 3. HANDWRITTEN TEXT - Gentle sway for .handwritten elements
    document.querySelectorAll('.handwritten, .quote-child').forEach(el => {
        el.animate([
            { transform: 'rotate(-0.5deg)' },
            { transform: 'rotate(0.5deg)' },
            { transform: 'rotate(-0.5deg)' }
        ], {
            duration: 5000,
            iterations: Infinity,
            easing: 'ease-in-out'
        });
    });
});
